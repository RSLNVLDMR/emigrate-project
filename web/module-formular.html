<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>–§–æ—Ä–º—É–ª—è—Ä –Ω–∞ –∫–∞—Ä—Ç—É –ø–æ–±—ã—Ç—É ‚Äî eMigrant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
<div class="screen">
  <div class="container">
    <div class="header">
      <div class="h1" data-i18n="formular_title">–§–æ—Ä–º—É–ª—è—Ä –Ω–∞ –∫–∞—Ä—Ç—É –ø–æ–±—ã—Ç—É</div>
      <div class="lang">
        <button data-lang="ru" class="active">RU</button>
        <button data-lang="ua">UA</button>
        <button data-lang="by">BY</button>
        <button data-lang="en">EN</button>
      </div>
    </div>

    <!-- –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–æ—Ä–º—É–ª—è—Ä–∞ -->
    <div class="card">
      <div class="h2" data-i18n="formular_description">–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º—É–ª—è—Ä</div>
      <div class="p muted" data-i18n="formular_description_text">
        –°–∫–∞—á–∞–π—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º—É–ª—è—Ä –¥–ª—è –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–ª–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç—É –ø–æ–±—ã—Ç—É. 
        –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö –≤–æ–µ–≤–æ–¥—Å—Ç–≤–∞—Ö –ü–æ–ª—å—à–∏.
      </div>
      
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div class="card" style="margin-top:12px">
      <div class="h2" data-i18n="formular_actions">–î–µ–π—Å—Ç–≤–∏—è</div>
      
      <div class="col" style="gap:12px; margin-top:12px">
        <button id="downloadBtn" class="btn full" data-i18n="formular_download">
          üì• –°–∫–∞—á–∞—Ç—å —Ñ–æ—Ä–º—É–ª—è—Ä
        </button>
        
        <button id="shareBtn" class="btn secondary full" data-i18n="formular_share">
          üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ñ–∞–π–ª–æ–º
        </button>
      </div>
    </div>

    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—é -->
    <div class="card" style="margin-top:12px">
      <div class="h2" data-i18n="formular_instructions">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—é</div>
      <ul class="p muted" style="margin-top:8px">
        <li data-i18n="formular_instruction_1">–ó–∞–ø–æ–ª–Ω—è–π—Ç–µ —Ñ–æ—Ä–º—É–ª—è—Ä –ø–µ—á–∞—Ç–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏</li>
        <li data-i18n="formular_instruction_2">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á–µ—Ä–Ω—É—é –∏–ª–∏ —Å–∏–Ω—é—é —Ä—É—á–∫—É</li>
        <li data-i18n="formular_instruction_3">–ù–µ –æ—Å—Ç–∞–≤–ª—è–π—Ç–µ –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π (—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–æ—á–µ—Ä–∫, –µ—Å–ª–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ)</li>
        <li data-i18n="formular_instruction_4">–ü—Ä–∏–ª–æ–∂–∏—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</li>
        <li data-i18n="formular_instruction_5">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –ø–æ–¥–∞—á–µ–π</li>
      </ul>
    </div>


  </div>

  <div class="tabs">
    <a class="tab" href="./translator.html" data-i18n="nav_translator">–ü–µ—Ä–µ–≤–æ–¥—á–∏–∫</a>
    <a class="tab" href="./checklist.html" data-i18n="nav_checklist">–ß–µ–∫–ª–∏—Å—Ç</a>
    <a class="tab" href="./consultant.html" data-i18n="nav_consultant">–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç</a>
  </div>
</div>

<script>
(function(){
  const $ = (s,r=document)=>r.querySelector(s);
  const $$ = (s,r=document)=>Array.from(r.querySelectorAll(s));
  const storage = { get(k,d=null){try{return JSON.parse(localStorage.getItem(k))??d}catch{return d}}, set(k,v){localStorage.setItem(k,JSON.stringify(v))} };

  // i18n
  const i18n = {
    lang: storage.get('lang','ru'),
    dict:{},
    async load(lang){
      const use = lang || i18n.lang;
      try{
        const res = await fetch(`./i18n/${use}.json`, {cache:'no-store'});
        if(res.ok){ i18n.dict = await res.json(); i18n.lang = use; storage.set('lang',use); }
      }catch(e){}
      applyTexts(); highlightLang();
    }
  };
  const t = (k)=> i18n.dict[k] || k;
  function applyTexts(){ $$('[data-i18n]').forEach(el=>{ const key=el.getAttribute('data-i18n'); if(i18n.dict[key]) el.textContent=i18n.dict[key]; }); document.documentElement.setAttribute('lang', i18n.lang); }
  function highlightLang(){ $$('.lang button').forEach(b=> b.classList.toggle('active', b.dataset.lang===i18n.lang)); }
  function bindLang(){ $$('.lang button').forEach(b=> b.onclick = ()=> i18n.load(b.dataset.lang)); }

  // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
  function downloadFormular() {
    const link = document.createElement('a');
    link.href = './files/formular-karta-pobytu.pdf';
    link.download = 'formular-karta-pobytu.pdf';
    link.target = '_blank';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  // –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ñ–∞–π–ª–æ–º
  async function shareFormular() {
    const fileUrl = window.location.origin + '/files/formular-karta-pobytu.pdf';
    
    if (navigator.share) {
      try {
        await navigator.share({
          title: '–§–æ—Ä–º—É–ª—è—Ä –Ω–∞ –∫–∞—Ä—Ç—É –ø–æ–±—ã—Ç—É',
          text: '–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º—É–ª—è—Ä –¥–ª—è –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–ª–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç—É –ø–æ–±—ã—Ç—É –≤ –ü–æ–ª—å—à–µ',
          url: fileUrl
        });
      } catch (err) {
        console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Web Share API:', err);
        fallbackShare(fileUrl);
      }
    } else {
      fallbackShare(fileUrl);
    }
  }

  // Fallback –¥–ª—è –ø–æ–¥–µ–ª–∏—Ç—å—Å—è
  function fallbackShare(fileUrl) {
    if (navigator.clipboard) {
      navigator.clipboard.writeText(fileUrl).then(() => {
        alert('–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
      }).catch(() => {
        promptShare(fileUrl);
      });
    } else {
      promptShare(fileUrl);
    }
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
  function promptShare(fileUrl) {
    const link = prompt('–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞:', fileUrl);
    if (link) {
      // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
    }
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
  function bindEvents() {
    $('#downloadBtn').onclick = downloadFormular;
    $('#shareBtn').onclick = shareFormular;
  }

  function initTG(){ const tg = window.Telegram && window.Telegram.WebApp; if(!tg) return; tg.expand(); tg.ready(); }

  async function boot(){
    initTG();
    bindLang();
    bindEvents();
    await i18n.load(storage.get('lang','ru'));
  }

  document.addEventListener('DOMContentLoaded', boot);
  window.addEventListener('pageshow', boot);
})();
</script>
</body>
</html>
